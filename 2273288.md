# [AI训练营]PaddleSeg实现语义分割Baseline

手把手教你基于PaddleSeg实现语义分割任务

------


# 一、作业任务

> 本次任务将基于PaddleSeg展开语义分割任务的学习与实践，baseline会提供PaddleSeg套件的基本使用，相关细节如有遗漏，可参考[10分钟上手PaddleSeg
](https://aistudio.baidu.com/aistudio/projectdetail/1672610?channelType=0&channel=0)

1. 选择提供的**五个数据集**中的一个数据集作为本次作业的训练数据，并**根据baseline跑通项目**

2. **可视化1-3张**预测图片与预测结果（本次提供的数据集没有验证与测试集，可将训练数据直接进行预测，展示训练数据的预测结果即可）


**加分项:**

3. 尝试**划分验证集**，再进行训练

4. 选择**其他网络**，调整训练参数进行更好的尝试


**PS**:PaddleSeg相关参考项目:

- [常规赛：PALM病理性近视病灶检测与分割基线方案](https://aistudio.baidu.com/aistudio/projectdetail/1941312)

- [PaddleSeg 2.0动态图：车道线图像分割任务简介](https://aistudio.baidu.com/aistudio/projectdetail/1752986?channelType=0&channel=0)

------

------

# 二、数据集说明

------

本项目使用的数据集是:[AI训练营]语义分割数据集合集，包含马分割，眼底血管分割，车道线分割，场景分割以及人像分割。

该数据集已加载到本环境中，位于:

**data/data103787/segDataset.zip**



```python
# unzip: 解压指令
# -o: 表示解压后进行输出
# -q: 表示静默模式，即不输出解压过程的日志
# -d: 解压到指定目录下，如果该文件夹不存在，会自动创建
!unzip -oq data/data103787/segDataset.zip -d segDataset
```

解压完成后，会在左侧文件目录多出一个**segDataset**的文件夹，该文件夹下有**5**个子文件夹：

- **horse -- 马分割数据**<二分类任务>

![](https://ai-studio-static-online.cdn.bcebos.com/2b12a7fab9ee409587a2aec332a70ba2bce0fcc4a10345a4aa38941db65e8d02)

- **fundusVessels -- 眼底血管分割数据**

> 灰度图，每个像素值对应相应的类别 -- 因此label不宜观察，但符合套件训练需要

![](https://ai-studio-static-online.cdn.bcebos.com/b515662defe548bdaa517b879722059ad53b5d87dd82441c8c4611124f6fdad0)

- **laneline -- 车道线分割数据**

![](https://ai-studio-static-online.cdn.bcebos.com/2aeccfe514e24cf98459df7c36421cddf78d9ddfc2cf41ffa4aafc10b13c8802)

- **facade -- 场景分割数据**

![](https://ai-studio-static-online.cdn.bcebos.com/57752d86fc5c4a10a3e4b91ae05a3e38d57d174419be4afeba22eb75b699112c)

- **cocome -- 人像分割数据**

> label非直接的图片，为json格式的标注文件，有需要的小伙伴可以看一看PaddleSeg的[PaddleSeg实战——人像分割](https://aistudio.baidu.com/aistudio/projectdetail/2177440?channelType=0&channel=0)


```python
# tree: 查看文件夹树状结构
# -L: 表示遍历深度
!tree segDataset -L 2
```

    segDataset
    ├── cocome
    │   ├── Annotations
    │   └── Images
    ├── facade
    │   ├── Annotations
    │   └── Images
    ├── FundusVessels
    │   ├── Annotations
    │   └── Images
    ├── horse
    │   ├── Annotations
    │   └── Images
    └── laneline
        ├── Annotations
        └── Images
    
    15 directories, 0 files


> 查看数据label的像素分布，可从中得知分割任务的类别数： 脚本位于: **show_segDataset_label_cls_id.py**

> 关于人像分割数据分析，这里不做提示，可参考[PaddleSeg实战——人像分割](https://aistudio.baidu.com/aistudio/projectdetail/2177440?channelType=0&channel=0)


```python
# 查看label中像素分类情况
!python show_segDataset_label_cls_id.py
```

    100%|████████████████████████████████████████| 328/328 [00:00<00:00, 905.19it/s]
    horse-cls_id:  [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 211, 212, 213, 214, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255]
    horse为90分类
    horse实际应转换为2分类(将非0像素转换为像素值为1)
    
    
    100%|████████████████████████████████████████| 845/845 [00:04<00:00, 196.66it/s]
    facade-cls_id:  [0, 1, 2, 3, 4, 5, 6, 7, 8]
    facade为9分类
    
    
    100%|████████████████████████████████████████| 200/200 [00:01<00:00, 184.25it/s]
    fundusvessels-cls_id:  [0, 1]
    fundusvessels为2分类
    
    
    100%|███████████████████████████████████████| 4878/4878 [01:28<00:00, 54.85it/s]
    laneline-cls_id:  [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]
    laneline为20分类


# 三、数据预处理

> 这里就以horse数据作为示例

-----

- 首先，通过上边的像素值分析以及horse本身的标签表现，我们确定horse数据集为二分类任务

- 然而，实际label中，却包含多个像素值，因此需要将horse中的所有label进行一个预处理

- 预处理内容为: 0值不变，非0值变为1，然后再保存label

- **并且保存文件格式为png，单通道图片为Label图片，最好保存为png——否则可能出现异常像素**

**对应horse的预处理脚本，位于:**

parse_horse_label.py


```python
!python parse_horse_label.py
```

    100%|████████████████████████████████████████| 328/328 [00:00<00:00, 392.07it/s]
    [0, 1]
    100%|███████████████████████████████████████| 328/328 [00:00<00:00, 1114.62it/s]
    horse-cls_id:  [0, 1]
    horse为2分类


- 预处理完成后，配置训练的索引文件txt，方便后边套件读取数据

> txt创建脚本位于: **horse_create_train_list.py**

> 同时，生成的txt位于: **segDataset/horse/train_list.txt**


```python
# 创建训练的数据索引txt
# 格式如下
# line1: train_img1.jpg train_label1.png
# line2: train_img2.jpg train_label2.png
!python horse_create_train_list.py
```

    100%|██████████████████████████████████████| 328/328 [00:00<00:00, 16397.67it/s]


# 四、使用套件开始训练

- 1.解压套件: 已挂载到本项目, 位于:**data/data102250/PaddleSeg-release-2.1.zip**


```python
# 解压套件
!unzip -oq data/data102250/PaddleSeg-release-2.1.zip
# 通过mv指令实现文件夹重命名
!mv PaddleSeg-release-2.1 PaddleSeg
```

- 2.选择模型，baseline选择**bisenet**, 位于: **PaddleSeg/configs/quick_start/bisenet_optic_disc_512x512_1k.yml**

- 3.配置模型文件

> 首先修改训练数据集加载的dataset类型:

![](https://ai-studio-static-online.cdn.bcebos.com/2f5363d71034490290f720ea8bb0d6873d7df2712d4b4e84ae41b0378aed8b89)

> 然后配置训练数据集如下:

![](https://ai-studio-static-online.cdn.bcebos.com/29547856db4b4bfc80aa3732e143f2788589f9316c694f369c9bd1da44b815dc)

> 类似的，配置验证数据集: -- **注意修改train_path为val_path**

![](https://ai-studio-static-online.cdn.bcebos.com/09713aaaed6b4611a525d25aae67e4f0538224f7ac0241eb941d97892bf6c4c1)

<font color="red" size=4>其它模型可能需要到: PaddleSeg/configs/$_base_$  中的数据集文件进行配置，但修改参数与bisenet中的数据集修改参数相同 </font>

![](https://ai-studio-static-online.cdn.bcebos.com/b154dcbf15e14f43aa13455c0ceeaaebe0489c9a09dd439f9d32e8b0a31355ec)


- 4.开始训练

使用PaddleSeg的train.py，传入模型文件即可开启训练


```python
!python PaddleSeg/train.py\
--config PaddleSeg/configs/quick_start/bisenet_optic_disc_512x512_1k.yml\
--batch_size 4\
--iters 2000\
--learning_rate 0.01\
--save_interval 200\
--save_dir PaddleSeg/output\
--seed 2021\
--log_iters 20\
--do_eval\
--use_vdl

# --batch_size 4\  # 批大小
# --iters 2000\    # 迭代次数 -- 根据数据大小，批大小估计迭代次数
# --learning_rate 0.01\ # 学习率
# --save_interval 200\ # 保存周期 -- 迭代次数计算周期
# --save_dir PaddleSeg/output\ # 输出路径
# --seed 2021\ # 训练中使用到的随机数种子
# --log_iters 20\ # 日志频率 -- 迭代次数计算周期
# --do_eval\ # 边训练边验证
# --use_vdl # 使用vdl可视化记录
# 用于断训==即中断后继续上一次状态进行训练
# --resume_model model_dir
```

    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/layers/utils.py:26: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
    Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
      def convert_to_list(value, n, name, dtype=np.int):
    2021-08-11 16:32:23 [INFO]	
    ------------Environment Information-------------
    platform: Linux-4.4.0-150-generic-x86_64-with-debian-stretch-sid
    Python: 3.7.4 (default, Aug 13 2019, 20:35:49) [GCC 7.3.0]
    Paddle compiled with cuda: True
    NVCC: Cuda compilation tools, release 10.1, V10.1.243
    cudnn: 7.6
    GPUs used: 1
    CUDA_VISIBLE_DEVICES: None
    GPU: ['GPU 0: Tesla V100-SXM2-32GB']
    GCC: gcc (Ubuntu 7.5.0-3ubuntu1~16.04) 7.5.0
    PaddlePaddle: 2.0.2
    OpenCV: 4.1.1
    ------------------------------------------------
    2021-08-11 16:32:23 [INFO]	
    ---------------Config Information---------------
    batch_size: 4
    iters: 2000
    loss:
      coef:
      - 1
      - 1
      - 1
      - 1
      - 1
      types:
      - ignore_index: 255
        type: CrossEntropyLoss
    lr_scheduler:
      end_lr: 0
      learning_rate: 0.01
      power: 0.9
      type: PolynomialDecay
    model:
      pretrained: null
      type: BiSeNetV2
    optimizer:
      momentum: 0.9
      type: sgd
      weight_decay: 4.0e-05
    train_dataset:
      dataset_root: segDataset/laneline
      mode: train
      num_classes: 20
      train_path: segDataset/laneline/train_list.txt
      transforms:
      - target_size:
        - 512
        - 512
        type: Resize
      - type: RandomHorizontalFlip
      - type: Normalize
      type: Dataset
    val_dataset:
      dataset_root: segDataset/laneline
      mode: val
      num_classes: 20
      transforms:
      - target_size:
        - 512
        - 512
        type: Resize
      - type: Normalize
      type: Dataset
      val_path: segDataset/laneline/train_list.txt
    ------------------------------------------------
    W0811 16:32:23.313866   639 device_context.cc:362] Please NOTE: device: 0, GPU Compute Capability: 7.0, Driver API Version: 10.1, Runtime API Version: 10.1
    W0811 16:32:23.313923   639 device_context.cc:372] device: 0, cuDNN Version: 7.6.
    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/dataloader/dataloader_iter.py:89: DeprecationWarning: `np.bool` is a deprecated alias for the builtin `bool`. To silence this warning, use `bool` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.bool_` here.
    Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
      if isinstance(slot[0], (np.ndarray, np.bool, numbers.Number)):
    2021-08-11 16:32:31 [INFO]	[TRAIN] epoch: 1, iter: 20/2000, loss: 6.6717, lr: 0.009914, batch_cost: 0.1880, reader_cost: 0.07454, ips: 21.2727 samples/sec | ETA 00:06:12
    2021-08-11 16:32:35 [INFO]	[TRAIN] epoch: 1, iter: 40/2000, loss: 1.4125, lr: 0.009824, batch_cost: 0.1608, reader_cost: 0.04790, ips: 24.8777 samples/sec | ETA 00:05:15
    2021-08-11 16:32:38 [INFO]	[TRAIN] epoch: 1, iter: 60/2000, loss: 1.2394, lr: 0.009734, batch_cost: 0.1630, reader_cost: 0.05015, ips: 24.5346 samples/sec | ETA 00:05:16
    2021-08-11 16:32:41 [INFO]	[TRAIN] epoch: 1, iter: 80/2000, loss: 1.0963, lr: 0.009644, batch_cost: 0.1591, reader_cost: 0.04823, ips: 25.1417 samples/sec | ETA 00:05:05
    2021-08-11 16:32:44 [INFO]	[TRAIN] epoch: 1, iter: 100/2000, loss: 0.9802, lr: 0.009553, batch_cost: 0.1568, reader_cost: 0.04086, ips: 25.5087 samples/sec | ETA 00:04:57
    2021-08-11 16:32:47 [INFO]	[TRAIN] epoch: 1, iter: 120/2000, loss: 0.9519, lr: 0.009463, batch_cost: 0.1608, reader_cost: 0.04683, ips: 24.8791 samples/sec | ETA 00:05:02
    2021-08-11 16:32:51 [INFO]	[TRAIN] epoch: 1, iter: 140/2000, loss: 0.8826, lr: 0.009372, batch_cost: 0.1634, reader_cost: 0.05217, ips: 24.4781 samples/sec | ETA 00:05:03
    2021-08-11 16:32:54 [INFO]	[TRAIN] epoch: 1, iter: 160/2000, loss: 0.9433, lr: 0.009282, batch_cost: 0.1510, reader_cost: 0.03605, ips: 26.4903 samples/sec | ETA 00:04:37
    2021-08-11 16:32:57 [INFO]	[TRAIN] epoch: 1, iter: 180/2000, loss: 0.9679, lr: 0.009191, batch_cost: 0.1556, reader_cost: 0.04475, ips: 25.7072 samples/sec | ETA 00:04:43
    2021-08-11 16:33:00 [INFO]	[TRAIN] epoch: 1, iter: 200/2000, loss: 0.8057, lr: 0.009100, batch_cost: 0.1574, reader_cost: 0.04632, ips: 25.4091 samples/sec | ETA 00:04:43
    2021-08-11 16:33:00 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/dygraph/math_op_patch.py:238: UserWarning: The dtype of left and right variables are not the same, left dtype is VarType.INT32, but right dtype is VarType.BOOL, the right dtype will convert to VarType.INT32
      format(lhs_dtype, rhs_dtype, lhs_dtype))
    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/dygraph/math_op_patch.py:238: UserWarning: The dtype of left and right variables are not the same, left dtype is VarType.INT64, but right dtype is VarType.BOOL, the right dtype will convert to VarType.INT64
      format(lhs_dtype, rhs_dtype, lhs_dtype))
    4878/4878 [==============================] - 175s 36ms/step - batch_cost: 0.0357 - reader cost: 0.001
    2021-08-11 16:35:55 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0669 Acc: 0.9720 Kappa: 0.2976 
    2021-08-11 16:35:55 [INFO]	[EVAL] Class IoU: 
    [0.973  0.     0.     0.0001 0.     0.     0.     0.     0.     0.
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.3658]
    2021-08-11 16:35:55 [INFO]	[EVAL] Class Acc: 
    [0.9749 0.     0.     0.1654 0.     0.     0.     0.     0.     0.
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.6348]
    2021-08-11 16:35:55 [INFO]	[EVAL] The model with the best validation mIoU (0.0669) was saved at iter 200.
    2021-08-11 16:35:58 [INFO]	[TRAIN] epoch: 1, iter: 220/2000, loss: 0.8446, lr: 0.009009, batch_cost: 0.1239, reader_cost: 0.01324, ips: 32.2795 samples/sec | ETA 00:03:40
    2021-08-11 16:36:01 [INFO]	[TRAIN] epoch: 1, iter: 240/2000, loss: 0.8057, lr: 0.008918, batch_cost: 0.1565, reader_cost: 0.04514, ips: 25.5516 samples/sec | ETA 00:04:35
    2021-08-11 16:36:04 [INFO]	[TRAIN] epoch: 1, iter: 260/2000, loss: 0.7800, lr: 0.008827, batch_cost: 0.1607, reader_cost: 0.04994, ips: 24.8893 samples/sec | ETA 00:04:39
    2021-08-11 16:36:07 [INFO]	[TRAIN] epoch: 1, iter: 280/2000, loss: 0.7481, lr: 0.008735, batch_cost: 0.1616, reader_cost: 0.04762, ips: 24.7522 samples/sec | ETA 00:04:37
    2021-08-11 16:36:10 [INFO]	[TRAIN] epoch: 1, iter: 300/2000, loss: 0.8184, lr: 0.008644, batch_cost: 0.1542, reader_cost: 0.04110, ips: 25.9409 samples/sec | ETA 00:04:22
    2021-08-11 16:36:14 [INFO]	[TRAIN] epoch: 1, iter: 320/2000, loss: 0.7585, lr: 0.008552, batch_cost: 0.1642, reader_cost: 0.05306, ips: 24.3537 samples/sec | ETA 00:04:35
    2021-08-11 16:36:17 [INFO]	[TRAIN] epoch: 1, iter: 340/2000, loss: 0.7958, lr: 0.008461, batch_cost: 0.1593, reader_cost: 0.04663, ips: 25.1088 samples/sec | ETA 00:04:24
    2021-08-11 16:36:20 [INFO]	[TRAIN] epoch: 1, iter: 360/2000, loss: 0.7224, lr: 0.008369, batch_cost: 0.1620, reader_cost: 0.05030, ips: 24.6880 samples/sec | ETA 00:04:25
    2021-08-11 16:36:23 [INFO]	[TRAIN] epoch: 1, iter: 380/2000, loss: 0.7256, lr: 0.008277, batch_cost: 0.1588, reader_cost: 0.04783, ips: 25.1852 samples/sec | ETA 00:04:17
    2021-08-11 16:36:26 [INFO]	[TRAIN] epoch: 1, iter: 400/2000, loss: 0.6840, lr: 0.008185, batch_cost: 0.1602, reader_cost: 0.04772, ips: 24.9678 samples/sec | ETA 00:04:16
    2021-08-11 16:36:26 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    4878/4878 [==============================] - 175s 36ms/step - batch_cost: 0.0357 - reader cost: 0.00
    2021-08-11 16:39:21 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0695 Acc: 0.9725 Kappa: 0.3429 
    2021-08-11 16:39:21 [INFO]	[EVAL] Class IoU: 
    [0.9741 0.0002 0.     0.0096 0.     0.     0.     0.     0.     0.
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.4062]
    2021-08-11 16:39:21 [INFO]	[EVAL] Class Acc: 
    [0.9764 0.4047 0.     0.3062 0.     0.     0.     0.     0.     0.
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.6171]
    2021-08-11 16:39:22 [INFO]	[EVAL] The model with the best validation mIoU (0.0695) was saved at iter 400.
    2021-08-11 16:39:24 [INFO]	[TRAIN] epoch: 1, iter: 420/2000, loss: 0.7489, lr: 0.008093, batch_cost: 0.1235, reader_cost: 0.01135, ips: 32.3930 samples/sec | ETA 00:03:15
    2021-08-11 16:39:27 [INFO]	[TRAIN] epoch: 1, iter: 440/2000, loss: 0.7158, lr: 0.008001, batch_cost: 0.1562, reader_cost: 0.04335, ips: 25.6108 samples/sec | ETA 00:04:03
    2021-08-11 16:39:30 [INFO]	[TRAIN] epoch: 1, iter: 460/2000, loss: 0.7383, lr: 0.007909, batch_cost: 0.1549, reader_cost: 0.04477, ips: 25.8263 samples/sec | ETA 00:03:58
    2021-08-11 16:39:33 [INFO]	[TRAIN] epoch: 1, iter: 480/2000, loss: 0.7526, lr: 0.007816, batch_cost: 0.1565, reader_cost: 0.04592, ips: 25.5582 samples/sec | ETA 00:03:57
    2021-08-11 16:39:37 [INFO]	[TRAIN] epoch: 1, iter: 500/2000, loss: 0.7305, lr: 0.007724, batch_cost: 0.1590, reader_cost: 0.04819, ips: 25.1643 samples/sec | ETA 00:03:58
    2021-08-11 16:39:40 [INFO]	[TRAIN] epoch: 1, iter: 520/2000, loss: 0.7045, lr: 0.007631, batch_cost: 0.1675, reader_cost: 0.05692, ips: 23.8755 samples/sec | ETA 00:04:07
    2021-08-11 16:39:43 [INFO]	[TRAIN] epoch: 1, iter: 540/2000, loss: 0.6843, lr: 0.007538, batch_cost: 0.1630, reader_cost: 0.05177, ips: 24.5349 samples/sec | ETA 00:03:58
    2021-08-11 16:39:46 [INFO]	[TRAIN] epoch: 1, iter: 560/2000, loss: 0.7203, lr: 0.007445, batch_cost: 0.1589, reader_cost: 0.04836, ips: 25.1786 samples/sec | ETA 00:03:48
    2021-08-11 16:39:50 [INFO]	[TRAIN] epoch: 1, iter: 580/2000, loss: 0.6618, lr: 0.007352, batch_cost: 0.1589, reader_cost: 0.04794, ips: 25.1675 samples/sec | ETA 00:03:45
    2021-08-11 16:39:53 [INFO]	[TRAIN] epoch: 1, iter: 600/2000, loss: 0.7276, lr: 0.007259, batch_cost: 0.1556, reader_cost: 0.04447, ips: 25.7105 samples/sec | ETA 00:03:37
    2021-08-11 16:39:53 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    4878/4878 [==============================] - 172s 35ms/step - batch_cost: 0.0350 - reader cost: 0.00
    2021-08-11 16:42:44 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0754 Acc: 0.9736 Kappa: 0.3495 
    2021-08-11 16:42:44 [INFO]	[EVAL] Class IoU: 
    [0.9753 0.0037 0.     0.1128 0.     0.     0.     0.     0.0027 0.
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.414 ]
    2021-08-11 16:42:44 [INFO]	[EVAL] Class Acc: 
    [0.9764 0.4489 0.     0.3411 0.     0.     0.     0.     0.4018 0.
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.7894]
    2021-08-11 16:42:45 [INFO]	[EVAL] The model with the best validation mIoU (0.0754) was saved at iter 600.
    2021-08-11 16:42:47 [INFO]	[TRAIN] epoch: 1, iter: 620/2000, loss: 0.7206, lr: 0.007166, batch_cost: 0.1269, reader_cost: 0.01585, ips: 31.5100 samples/sec | ETA 00:02:55
    2021-08-11 16:42:50 [INFO]	[TRAIN] epoch: 1, iter: 640/2000, loss: 0.6300, lr: 0.007072, batch_cost: 0.1589, reader_cost: 0.04823, ips: 25.1691 samples/sec | ETA 00:03:36
    2021-08-11 16:42:53 [INFO]	[TRAIN] epoch: 1, iter: 660/2000, loss: 0.7059, lr: 0.006978, batch_cost: 0.1534, reader_cost: 0.04180, ips: 26.0838 samples/sec | ETA 00:03:25
    2021-08-11 16:42:57 [INFO]	[TRAIN] epoch: 1, iter: 680/2000, loss: 0.7182, lr: 0.006885, batch_cost: 0.1589, reader_cost: 0.04795, ips: 25.1759 samples/sec | ETA 00:03:29
    2021-08-11 16:43:00 [INFO]	[TRAIN] epoch: 1, iter: 700/2000, loss: 0.6725, lr: 0.006791, batch_cost: 0.1593, reader_cost: 0.05030, ips: 25.1146 samples/sec | ETA 00:03:27
    2021-08-11 16:43:03 [INFO]	[TRAIN] epoch: 1, iter: 720/2000, loss: 0.6963, lr: 0.006697, batch_cost: 0.1552, reader_cost: 0.04542, ips: 25.7790 samples/sec | ETA 00:03:18
    2021-08-11 16:43:06 [INFO]	[TRAIN] epoch: 1, iter: 740/2000, loss: 0.7117, lr: 0.006603, batch_cost: 0.1578, reader_cost: 0.04583, ips: 25.3480 samples/sec | ETA 00:03:18
    2021-08-11 16:43:09 [INFO]	[TRAIN] epoch: 1, iter: 760/2000, loss: 0.6538, lr: 0.006508, batch_cost: 0.1632, reader_cost: 0.05243, ips: 24.5069 samples/sec | ETA 00:03:22
    2021-08-11 16:43:12 [INFO]	[TRAIN] epoch: 1, iter: 780/2000, loss: 0.7012, lr: 0.006414, batch_cost: 0.1577, reader_cost: 0.04312, ips: 25.3684 samples/sec | ETA 00:03:12
    2021-08-11 16:43:16 [INFO]	[TRAIN] epoch: 1, iter: 800/2000, loss: 0.6838, lr: 0.006319, batch_cost: 0.1644, reader_cost: 0.05326, ips: 24.3244 samples/sec | ETA 00:03:17
    2021-08-11 16:43:16 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    4878/4878 [==============================] - 175s 36ms/step - batch_cost: 0.0357 - reader cost: 0.002
    2021-08-11 16:46:11 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0805 Acc: 0.9743 Kappa: 0.3979 
    2021-08-11 16:46:11 [INFO]	[EVAL] Class IoU: 
    [0.9764 0.0326 0.     0.0979 0.     0.     0.     0.     0.0429 0.
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.4595]
    2021-08-11 16:46:11 [INFO]	[EVAL] Class Acc: 
    [0.978  0.3675 0.     0.3957 0.     0.     0.     0.     0.3764 0.5187
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.7235]
    2021-08-11 16:46:11 [INFO]	[EVAL] The model with the best validation mIoU (0.0805) was saved at iter 800.
    2021-08-11 16:46:13 [INFO]	[TRAIN] epoch: 1, iter: 820/2000, loss: 0.6812, lr: 0.006224, batch_cost: 0.1256, reader_cost: 0.01544, ips: 31.8404 samples/sec | ETA 00:02:28
    2021-08-11 16:46:17 [INFO]	[TRAIN] epoch: 1, iter: 840/2000, loss: 0.6423, lr: 0.006129, batch_cost: 0.1543, reader_cost: 0.04266, ips: 25.9175 samples/sec | ETA 00:02:59
    2021-08-11 16:46:20 [INFO]	[TRAIN] epoch: 1, iter: 860/2000, loss: 0.6840, lr: 0.006034, batch_cost: 0.1663, reader_cost: 0.05391, ips: 24.0542 samples/sec | ETA 00:03:09
    2021-08-11 16:46:23 [INFO]	[TRAIN] epoch: 1, iter: 880/2000, loss: 0.7437, lr: 0.005939, batch_cost: 0.1621, reader_cost: 0.05105, ips: 24.6825 samples/sec | ETA 00:03:01
    2021-08-11 16:46:26 [INFO]	[TRAIN] epoch: 1, iter: 900/2000, loss: 0.7080, lr: 0.005844, batch_cost: 0.1597, reader_cost: 0.04896, ips: 25.0496 samples/sec | ETA 00:02:55
    2021-08-11 16:46:29 [INFO]	[TRAIN] epoch: 1, iter: 920/2000, loss: 0.6559, lr: 0.005748, batch_cost: 0.1541, reader_cost: 0.04375, ips: 25.9602 samples/sec | ETA 00:02:46
    2021-08-11 16:46:33 [INFO]	[TRAIN] epoch: 1, iter: 940/2000, loss: 0.7005, lr: 0.005652, batch_cost: 0.1629, reader_cost: 0.05146, ips: 24.5496 samples/sec | ETA 00:02:52
    2021-08-11 16:46:36 [INFO]	[TRAIN] epoch: 1, iter: 960/2000, loss: 0.6776, lr: 0.005556, batch_cost: 0.1592, reader_cost: 0.04452, ips: 25.1185 samples/sec | ETA 00:02:45
    2021-08-11 16:46:39 [INFO]	[TRAIN] epoch: 1, iter: 980/2000, loss: 0.6801, lr: 0.005460, batch_cost: 0.1551, reader_cost: 0.04308, ips: 25.7928 samples/sec | ETA 00:02:38
    2021-08-11 16:46:42 [INFO]	[TRAIN] epoch: 1, iter: 1000/2000, loss: 0.6851, lr: 0.005364, batch_cost: 0.1573, reader_cost: 0.04623, ips: 25.4268 samples/sec | ETA 00:02:37
    2021-08-11 16:46:42 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    4878/4878 [==============================] - 172s 35ms/step - batch_cost: 0.0352 - reader cost: 0.001
    2021-08-11 16:49:35 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0870 Acc: 0.9748 Kappa: 0.4411 
    2021-08-11 16:49:35 [INFO]	[EVAL] Class IoU: 
    [0.9775 0.0462 0.     0.1401 0.     0.     0.     0.     0.0885 0.0001
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.4874]
    2021-08-11 16:49:35 [INFO]	[EVAL] Class Acc: 
    [0.9798 0.3802 0.     0.3881 0.     0.     0.     0.     0.4365 0.1462
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.7083]
    2021-08-11 16:49:35 [INFO]	[EVAL] The model with the best validation mIoU (0.0870) was saved at iter 1000.
    2021-08-11 16:49:38 [INFO]	[TRAIN] epoch: 1, iter: 1020/2000, loss: 0.6474, lr: 0.005267, batch_cost: 0.1306, reader_cost: 0.01834, ips: 30.6347 samples/sec | ETA 00:02:07
    2021-08-11 16:49:41 [INFO]	[TRAIN] epoch: 1, iter: 1040/2000, loss: 0.6379, lr: 0.005170, batch_cost: 0.1629, reader_cost: 0.04831, ips: 24.5569 samples/sec | ETA 00:02:36
    2021-08-11 16:49:44 [INFO]	[TRAIN] epoch: 1, iter: 1060/2000, loss: 0.6191, lr: 0.005073, batch_cost: 0.1600, reader_cost: 0.05058, ips: 25.0034 samples/sec | ETA 00:02:30
    2021-08-11 16:49:47 [INFO]	[TRAIN] epoch: 1, iter: 1080/2000, loss: 0.5967, lr: 0.004976, batch_cost: 0.1625, reader_cost: 0.05110, ips: 24.6228 samples/sec | ETA 00:02:29
    2021-08-11 16:49:50 [INFO]	[TRAIN] epoch: 1, iter: 1100/2000, loss: 0.6450, lr: 0.004879, batch_cost: 0.1568, reader_cost: 0.04551, ips: 25.5056 samples/sec | ETA 00:02:21
    2021-08-11 16:49:54 [INFO]	[TRAIN] epoch: 1, iter: 1120/2000, loss: 0.5805, lr: 0.004781, batch_cost: 0.1585, reader_cost: 0.04736, ips: 25.2332 samples/sec | ETA 00:02:19
    2021-08-11 16:49:57 [INFO]	[TRAIN] epoch: 1, iter: 1140/2000, loss: 0.7028, lr: 0.004684, batch_cost: 0.1638, reader_cost: 0.05300, ips: 24.4143 samples/sec | ETA 00:02:20
    2021-08-11 16:50:00 [INFO]	[TRAIN] epoch: 1, iter: 1160/2000, loss: 0.6280, lr: 0.004586, batch_cost: 0.1604, reader_cost: 0.04980, ips: 24.9317 samples/sec | ETA 00:02:14
    2021-08-11 16:50:03 [INFO]	[TRAIN] epoch: 1, iter: 1180/2000, loss: 0.6497, lr: 0.004487, batch_cost: 0.1529, reader_cost: 0.04204, ips: 26.1589 samples/sec | ETA 00:02:05
    2021-08-11 16:50:06 [INFO]	[TRAIN] epoch: 1, iter: 1200/2000, loss: 0.5725, lr: 0.004389, batch_cost: 0.1664, reader_cost: 0.05424, ips: 24.0320 samples/sec | ETA 00:02:13
    2021-08-11 16:50:06 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    4878/4878 [==============================] - 176s 36ms/step - batch_cost: 0.0360 - reader cost: 0.002
    2021-08-11 16:53:03 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0868 Acc: 0.9751 Kappa: 0.4181 
    2021-08-11 16:53:03 [INFO]	[EVAL] Class IoU: 
    [0.9772 0.0479 0.     0.1238 0.     0.     0.     0.     0.1092 0.
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.4778]
    2021-08-11 16:53:03 [INFO]	[EVAL] Class Acc: 
    [0.9786 0.3987 0.     0.4431 0.     0.     0.     0.     0.4133 0.1471
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.7781]
    2021-08-11 16:53:03 [INFO]	[EVAL] The model with the best validation mIoU (0.0870) was saved at iter 1000.
    2021-08-11 16:53:06 [INFO]	[TRAIN] epoch: 2, iter: 1220/2000, loss: 0.6353, lr: 0.004290, batch_cost: 0.1315, reader_cost: 0.02103, ips: 30.4152 samples/sec | ETA 00:01:42
    2021-08-11 16:53:09 [INFO]	[TRAIN] epoch: 2, iter: 1240/2000, loss: 0.6669, lr: 0.004191, batch_cost: 0.1568, reader_cost: 0.04572, ips: 25.5127 samples/sec | ETA 00:01:59
    2021-08-11 16:53:12 [INFO]	[TRAIN] epoch: 2, iter: 1260/2000, loss: 0.6592, lr: 0.004092, batch_cost: 0.1564, reader_cost: 0.04494, ips: 25.5706 samples/sec | ETA 00:01:55
    2021-08-11 16:53:15 [INFO]	[TRAIN] epoch: 2, iter: 1280/2000, loss: 0.5848, lr: 0.003992, batch_cost: 0.1625, reader_cost: 0.04944, ips: 24.6120 samples/sec | ETA 00:01:57
    2021-08-11 16:53:18 [INFO]	[TRAIN] epoch: 2, iter: 1300/2000, loss: 0.6000, lr: 0.003892, batch_cost: 0.1529, reader_cost: 0.04208, ips: 26.1660 samples/sec | ETA 00:01:47
    2021-08-11 16:53:22 [INFO]	[TRAIN] epoch: 2, iter: 1320/2000, loss: 0.6373, lr: 0.003792, batch_cost: 0.1618, reader_cost: 0.05050, ips: 24.7224 samples/sec | ETA 00:01:50
    2021-08-11 16:53:25 [INFO]	[TRAIN] epoch: 2, iter: 1340/2000, loss: 0.6023, lr: 0.003692, batch_cost: 0.1598, reader_cost: 0.04808, ips: 25.0259 samples/sec | ETA 00:01:45
    2021-08-11 16:53:28 [INFO]	[TRAIN] epoch: 2, iter: 1360/2000, loss: 0.6101, lr: 0.003591, batch_cost: 0.1580, reader_cost: 0.04646, ips: 25.3183 samples/sec | ETA 00:01:41
    2021-08-11 16:53:31 [INFO]	[TRAIN] epoch: 2, iter: 1380/2000, loss: 0.6459, lr: 0.003490, batch_cost: 0.1604, reader_cost: 0.04897, ips: 24.9331 samples/sec | ETA 00:01:39
    2021-08-11 16:53:34 [INFO]	[TRAIN] epoch: 2, iter: 1400/2000, loss: 0.5644, lr: 0.003389, batch_cost: 0.1586, reader_cost: 0.04546, ips: 25.2214 samples/sec | ETA 00:01:35
    2021-08-11 16:53:34 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    4878/4878 [==============================] - 174s 36ms/step - batch_cost: 0.0356 - reader cost: 0.00
    2021-08-11 16:56:29 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0917 Acc: 0.9754 Kappa: 0.4585 
    2021-08-11 16:56:29 [INFO]	[EVAL] Class IoU: 
    [0.9782 0.0579 0.     0.1377 0.     0.     0.     0.     0.1586 0.
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.5019]
    2021-08-11 16:56:29 [INFO]	[EVAL] Class Acc: 
    [0.9804 0.3931 0.     0.4674 0.     0.     0.     0.     0.3867 0.1581
     0.0066 0.     0.     0.     0.     0.     0.     0.     0.     0.7236]
    2021-08-11 16:56:29 [INFO]	[EVAL] The model with the best validation mIoU (0.0917) was saved at iter 1400.
    2021-08-11 16:56:32 [INFO]	[TRAIN] epoch: 2, iter: 1420/2000, loss: 0.6612, lr: 0.003287, batch_cost: 0.1289, reader_cost: 0.01783, ips: 31.0409 samples/sec | ETA 00:01:14
    2021-08-11 16:56:35 [INFO]	[TRAIN] epoch: 2, iter: 1440/2000, loss: 0.6636, lr: 0.003185, batch_cost: 0.1581, reader_cost: 0.04380, ips: 25.3058 samples/sec | ETA 00:01:28
    2021-08-11 16:56:38 [INFO]	[TRAIN] epoch: 2, iter: 1460/2000, loss: 0.6104, lr: 0.003083, batch_cost: 0.1537, reader_cost: 0.04240, ips: 26.0242 samples/sec | ETA 00:01:22
    2021-08-11 16:56:41 [INFO]	[TRAIN] epoch: 2, iter: 1480/2000, loss: 0.5959, lr: 0.002980, batch_cost: 0.1670, reader_cost: 0.05666, ips: 23.9464 samples/sec | ETA 00:01:26
    2021-08-11 16:56:45 [INFO]	[TRAIN] epoch: 2, iter: 1500/2000, loss: 0.6043, lr: 0.002877, batch_cost: 0.1650, reader_cost: 0.05364, ips: 24.2446 samples/sec | ETA 00:01:22
    2021-08-11 16:56:48 [INFO]	[TRAIN] epoch: 2, iter: 1520/2000, loss: 0.6071, lr: 0.002773, batch_cost: 0.1595, reader_cost: 0.04885, ips: 25.0854 samples/sec | ETA 00:01:16
    2021-08-11 16:56:51 [INFO]	[TRAIN] epoch: 2, iter: 1540/2000, loss: 0.6436, lr: 0.002669, batch_cost: 0.1582, reader_cost: 0.04453, ips: 25.2799 samples/sec | ETA 00:01:12
    2021-08-11 16:56:54 [INFO]	[TRAIN] epoch: 2, iter: 1560/2000, loss: 0.5954, lr: 0.002565, batch_cost: 0.1664, reader_cost: 0.05606, ips: 24.0334 samples/sec | ETA 00:01:13
    2021-08-11 16:56:57 [INFO]	[TRAIN] epoch: 2, iter: 1580/2000, loss: 0.6523, lr: 0.002460, batch_cost: 0.1604, reader_cost: 0.04849, ips: 24.9361 samples/sec | ETA 00:01:07
    2021-08-11 16:57:01 [INFO]	[TRAIN] epoch: 2, iter: 1600/2000, loss: 0.6094, lr: 0.002355, batch_cost: 0.1571, reader_cost: 0.04603, ips: 25.4554 samples/sec | ETA 00:01:02
    2021-08-11 16:57:01 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    4878/4878 [==============================] - 175s 36ms/step - batch_cost: 0.0357 - reader cost: 0.00
    2021-08-11 16:59:56 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0929 Acc: 0.9758 Kappa: 0.4601 
    2021-08-11 16:59:56 [INFO]	[EVAL] Class IoU: 
    [0.9784 0.0681 0.     0.1535 0.     0.     0.     0.     0.1444 0.0014
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.5121]
    2021-08-11 16:59:56 [INFO]	[EVAL] Class Acc: 
    [0.9802 0.3881 0.     0.4693 0.     0.     0.     0.     0.4462 0.2796
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.7558]
    2021-08-11 16:59:56 [INFO]	[EVAL] The model with the best validation mIoU (0.0929) was saved at iter 1600.
    2021-08-11 16:59:58 [INFO]	[TRAIN] epoch: 2, iter: 1620/2000, loss: 0.6939, lr: 0.002249, batch_cost: 0.1179, reader_cost: 0.00604, ips: 33.9297 samples/sec | ETA 00:00:44
    2021-08-11 17:00:01 [INFO]	[TRAIN] epoch: 2, iter: 1640/2000, loss: 0.6279, lr: 0.002142, batch_cost: 0.1579, reader_cost: 0.04681, ips: 25.3400 samples/sec | ETA 00:00:56
    2021-08-11 17:00:05 [INFO]	[TRAIN] epoch: 2, iter: 1660/2000, loss: 0.6605, lr: 0.002035, batch_cost: 0.1539, reader_cost: 0.04266, ips: 25.9907 samples/sec | ETA 00:00:52
    2021-08-11 17:00:08 [INFO]	[TRAIN] epoch: 2, iter: 1680/2000, loss: 0.5942, lr: 0.001927, batch_cost: 0.1642, reader_cost: 0.04810, ips: 24.3581 samples/sec | ETA 00:00:52
    2021-08-11 17:00:11 [INFO]	[TRAIN] epoch: 2, iter: 1700/2000, loss: 0.5707, lr: 0.001819, batch_cost: 0.1574, reader_cost: 0.04583, ips: 25.4129 samples/sec | ETA 00:00:47
    2021-08-11 17:00:14 [INFO]	[TRAIN] epoch: 2, iter: 1720/2000, loss: 0.6306, lr: 0.001710, batch_cost: 0.1586, reader_cost: 0.04764, ips: 25.2248 samples/sec | ETA 00:00:44
    2021-08-11 17:00:17 [INFO]	[TRAIN] epoch: 2, iter: 1740/2000, loss: 0.6650, lr: 0.001600, batch_cost: 0.1602, reader_cost: 0.04798, ips: 24.9663 samples/sec | ETA 00:00:41
    2021-08-11 17:00:21 [INFO]	[TRAIN] epoch: 2, iter: 1760/2000, loss: 0.5911, lr: 0.001489, batch_cost: 0.1598, reader_cost: 0.04809, ips: 25.0347 samples/sec | ETA 00:00:38
    2021-08-11 17:00:24 [INFO]	[TRAIN] epoch: 2, iter: 1780/2000, loss: 0.6675, lr: 0.001377, batch_cost: 0.1569, reader_cost: 0.04445, ips: 25.4954 samples/sec | ETA 00:00:34
    2021-08-11 17:00:27 [INFO]	[TRAIN] epoch: 2, iter: 1800/2000, loss: 0.6188, lr: 0.001265, batch_cost: 0.1611, reader_cost: 0.04939, ips: 24.8318 samples/sec | ETA 00:00:32
    2021-08-11 17:00:27 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    4878/4878 [==============================] - 176s 36ms/step - batch_cost: 0.0360 - reader cost: 0.00
    2021-08-11 17:03:23 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0968 Acc: 0.9761 Kappa: 0.4754 
    2021-08-11 17:03:23 [INFO]	[EVAL] Class IoU: 
    [0.9789 0.0757 0.     0.1807 0.     0.     0.     0.     0.1738 0.0034
     0.0001 0.     0.     0.     0.     0.     0.     0.     0.     0.523 ]
    2021-08-11 17:03:23 [INFO]	[EVAL] Class Acc: 
    [0.9808 0.3836 0.     0.4503 0.     0.     0.     0.     0.427  0.2563
     0.0919 0.     0.     0.     0.     0.     0.     0.     0.     0.7875]
    2021-08-11 17:03:24 [INFO]	[EVAL] The model with the best validation mIoU (0.0968) was saved at iter 1800.
    2021-08-11 17:03:26 [INFO]	[TRAIN] epoch: 2, iter: 1820/2000, loss: 0.5624, lr: 0.001151, batch_cost: 0.1310, reader_cost: 0.01942, ips: 30.5345 samples/sec | ETA 00:00:23
    2021-08-11 17:03:29 [INFO]	[TRAIN] epoch: 2, iter: 1840/2000, loss: 0.6390, lr: 0.001036, batch_cost: 0.1567, reader_cost: 0.04219, ips: 25.5232 samples/sec | ETA 00:00:25
    2021-08-11 17:03:33 [INFO]	[TRAIN] epoch: 2, iter: 1860/2000, loss: 0.5666, lr: 0.000919, batch_cost: 0.1680, reader_cost: 0.05447, ips: 23.8078 samples/sec | ETA 00:00:23
    2021-08-11 17:03:36 [INFO]	[TRAIN] epoch: 2, iter: 1880/2000, loss: 0.5763, lr: 0.000801, batch_cost: 0.1542, reader_cost: 0.04175, ips: 25.9487 samples/sec | ETA 00:00:18
    2021-08-11 17:03:39 [INFO]	[TRAIN] epoch: 2, iter: 1900/2000, loss: 0.6796, lr: 0.000681, batch_cost: 0.1634, reader_cost: 0.05224, ips: 24.4830 samples/sec | ETA 00:00:16
    2021-08-11 17:03:42 [INFO]	[TRAIN] epoch: 2, iter: 1920/2000, loss: 0.6340, lr: 0.000558, batch_cost: 0.1649, reader_cost: 0.05335, ips: 24.2519 samples/sec | ETA 00:00:13
    2021-08-11 17:03:46 [INFO]	[TRAIN] epoch: 2, iter: 1940/2000, loss: 0.5729, lr: 0.000432, batch_cost: 0.1609, reader_cost: 0.04725, ips: 24.8640 samples/sec | ETA 00:00:09
    2021-08-11 17:03:49 [INFO]	[TRAIN] epoch: 2, iter: 1960/2000, loss: 0.6476, lr: 0.000302, batch_cost: 0.1574, reader_cost: 0.04663, ips: 25.4202 samples/sec | ETA 00:00:06
    2021-08-11 17:03:52 [INFO]	[TRAIN] epoch: 2, iter: 1980/2000, loss: 0.6294, lr: 0.000166, batch_cost: 0.1558, reader_cost: 0.04445, ips: 25.6680 samples/sec | ETA 00:00:03
    2021-08-11 17:03:55 [INFO]	[TRAIN] epoch: 2, iter: 2000/2000, loss: 0.6021, lr: 0.000011, batch_cost: 0.1602, reader_cost: 0.04930, ips: 24.9756 samples/sec | ETA 00:00:00
    2021-08-11 17:03:55 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    4878/4878 [==============================] - 174s 36ms/step - batch_cost: 0.0355 - reader cost: 0.00
    2021-08-11 17:06:49 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0953 Acc: 0.9759 Kappa: 0.4768 
    2021-08-11 17:06:49 [INFO]	[EVAL] Class IoU: 
    [0.9788 0.074  0.     0.1791 0.     0.     0.     0.     0.1494 0.0033
     0.     0.     0.     0.     0.     0.     0.     0.     0.     0.5219]
    2021-08-11 17:06:49 [INFO]	[EVAL] Class Acc: 
    [0.981  0.3994 0.     0.4526 0.     0.     0.     0.     0.4431 0.3015
     0.0207 0.     0.     0.     0.     0.     0.     0.     0.     0.7484]
    2021-08-11 17:06:49 [INFO]	[EVAL] The model with the best validation mIoU (0.0968) was saved at iter 1800.
    <class 'paddle.nn.layer.conv.Conv2D'>'s flops has been counted
    Customize Function has been applied to <class 'paddle.nn.layer.norm.SyncBatchNorm'>
    Cannot find suitable count function for <class 'paddle.nn.layer.pooling.MaxPool2D'>. Treat it as zero FLOPs.
    <class 'paddle.nn.layer.pooling.AdaptiveAvgPool2D'>'s flops has been counted
    <class 'paddle.nn.layer.pooling.AvgPool2D'>'s flops has been counted
    Cannot find suitable count function for <class 'paddle.nn.layer.activation.Sigmoid'>. Treat it as zero FLOPs.
    <class 'paddle.nn.layer.common.Dropout'>'s flops has been counted
    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/tensor/creation.py:143: DeprecationWarning: `np.object` is a deprecated alias for the builtin `object`. To silence this warning, use `object` by itself. Doing this will not modify any behavior and is safe. 
    Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
      if data.dtype == np.object:
    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/dygraph/math_op_patch.py:238: UserWarning: The dtype of left and right variables are not the same, left dtype is VarType.FP32, but right dtype is VarType.INT32, the right dtype will convert to VarType.FP32
      format(lhs_dtype, rhs_dtype, lhs_dtype))
    Total Flops: 8070561792     Total Params: 2330668



```python
# 单独进行评估 -- 上边do_eval就是这个工作
!python PaddleSeg/val.py\
--config PaddleSeg/configs/quick_start/bisenet_optic_disc_512x512_1k.yml\
--model_path PaddleSeg/output/best_model/model.pdparams
# model_path： 模型参数路径
```

    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/layers/utils.py:26: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
    Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
      def convert_to_list(value, n, name, dtype=np.int):
    2021-08-11 17:07:54 [INFO]	
    ---------------Config Information---------------
    batch_size: 4
    iters: 2000
    loss:
      coef:
      - 1
      - 1
      - 1
      - 1
      - 1
      types:
      - type: CrossEntropyLoss
    lr_scheduler:
      end_lr: 0
      learning_rate: 0.01
      power: 0.9
      type: PolynomialDecay
    model:
      pretrained: null
      type: BiSeNetV2
    optimizer:
      momentum: 0.9
      type: sgd
      weight_decay: 4.0e-05
    train_dataset:
      dataset_root: segDataset/laneline
      mode: train
      num_classes: 20
      train_path: segDataset/laneline/train_list.txt
      transforms:
      - target_size:
        - 512
        - 512
        type: Resize
      - type: RandomHorizontalFlip
      - type: Normalize
      type: Dataset
    val_dataset:
      dataset_root: segDataset/laneline
      mode: val
      num_classes: 20
      transforms:
      - target_size:
        - 512
        - 512
        type: Resize
      - type: Normalize
      type: Dataset
      val_path: segDataset/laneline/train_list.txt
    ------------------------------------------------
    W0811 17:07:54.699244  1987 device_context.cc:362] Please NOTE: device: 0, GPU Compute Capability: 7.0, Driver API Version: 10.1, Runtime API Version: 10.1
    W0811 17:07:54.699309  1987 device_context.cc:372] device: 0, cuDNN Version: 7.6.
    2021-08-11 17:07:59 [INFO]	Loading pretrained model from PaddleSeg/output/best_model/model.pdparams
    2021-08-11 17:07:59 [INFO]	There are 356/356 variables loaded into BiSeNetV2.
    2021-08-11 17:07:59 [INFO]	Loaded trained params of model successfully
    2021-08-11 17:07:59 [INFO]	Start evaluating (total_samples: 4878, total_iters: 4878)...
    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/dataloader/dataloader_iter.py:89: DeprecationWarning: `np.bool` is a deprecated alias for the builtin `bool`. To silence this warning, use `bool` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.bool_` here.
    Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
      if isinstance(slot[0], (np.ndarray, np.bool, numbers.Number)):
    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/dygraph/math_op_patch.py:238: UserWarning: The dtype of left and right variables are not the same, left dtype is VarType.INT32, but right dtype is VarType.BOOL, the right dtype will convert to VarType.INT32
      format(lhs_dtype, rhs_dtype, lhs_dtype))
    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/dygraph/math_op_patch.py:238: UserWarning: The dtype of left and right variables are not the same, left dtype is VarType.INT64, but right dtype is VarType.BOOL, the right dtype will convert to VarType.INT64
      format(lhs_dtype, rhs_dtype, lhs_dtype))
    4878/4878 [==============================] - 174s 36ms/step - batch_cost: 0.0356 - reader cost: 0.00
    2021-08-11 17:10:53 [INFO]	[EVAL] #Images: 4878 mIoU: 0.0968 Acc: 0.9761 Kappa: 0.4754 
    2021-08-11 17:10:53 [INFO]	[EVAL] Class IoU: 
    [0.9789 0.0757 0.     0.1807 0.     0.     0.     0.     0.1738 0.0034
     0.0001 0.     0.     0.     0.     0.     0.     0.     0.     0.523 ]
    2021-08-11 17:10:53 [INFO]	[EVAL] Class Acc: 
    [0.9808 0.3836 0.     0.4503 0.     0.     0.     0.     0.427  0.2563
     0.0919 0.     0.     0.     0.     0.     0.     0.     0.     0.7875]


- 5.开始预测


```python
# 进行预测
!python PaddleSeg/predict.py\
--config PaddleSeg/configs/quick_start/bisenet_optic_disc_512x512_1k.yml\
--model_path PaddleSeg/output/best_model/model.pdparams\
--image_path segDataset/laneline/Images\
--save_dir PaddleSeg/output/laneline
# image_path: 预测图片路径/文件夹 -- 这里直接对训练数据进行预测，得到预测结果
# save_dir： 保存预测结果的路径 -- 保存的预测结果为图片
```

    /opt/conda/envs/python35-paddle120-env/lib/python3.7/site-packages/paddle/fluid/layers/utils.py:26: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
    Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
      def convert_to_list(value, n, name, dtype=np.int):
    2021-08-11 17:13:37 [INFO]	
    ---------------Config Information---------------
    batch_size: 4
    iters: 2000
    loss:
      coef:
      - 1
      - 1
      - 1
      - 1
      - 1
      types:
      - type: CrossEntropyLoss
    lr_scheduler:
      end_lr: 0
      learning_rate: 0.01
      power: 0.9
      type: PolynomialDecay
    model:
      pretrained: null
      type: BiSeNetV2
    optimizer:
      momentum: 0.9
      type: sgd
      weight_decay: 4.0e-05
    train_dataset:
      dataset_root: segDataset/laneline
      mode: train
      num_classes: 20
      train_path: segDataset/laneline/train_list.txt
      transforms:
      - target_size:
        - 512
        - 512
        type: Resize
      - type: RandomHorizontalFlip
      - type: Normalize
      type: Dataset
    val_dataset:
      dataset_root: segDataset/laneline
      mode: val
      num_classes: 20
      transforms:
      - target_size:
        - 512
        - 512
        type: Resize
      - type: Normalize
      type: Dataset
      val_path: segDataset/laneline/train_list.txt
    ------------------------------------------------
    W0811 17:13:37.802075  2371 device_context.cc:362] Please NOTE: device: 0, GPU Compute Capability: 7.0, Driver API Version: 10.1, Runtime API Version: 10.1
    W0811 17:13:37.802145  2371 device_context.cc:372] device: 0, cuDNN Version: 7.6.
    2021-08-11 17:13:42 [INFO]	Number of predict images = 4878
    2021-08-11 17:13:42 [INFO]	Loading pretrained model from PaddleSeg/output/best_model/model.pdparams
    2021-08-11 17:13:42 [INFO]	There are 356/356 variables loaded into BiSeNetV2.
    2021-08-11 17:13:42 [INFO]	Start to predict...
    4878/4878 [==============================] - 483s 99ms/st


# 五、可视化预测结果

通过PaddleSeg预测输出的结果为图片，对应位于:PaddleSeg/output/horse

其中包含两种结果：

- 一种为掩膜图像，即叠加预测结果与原始结果的图像 -- 位于: **PaddleSeg/output/horse/added_prediction**
- 另一种为预测结果的伪彩色图像，即预测的结果图像 -- 位于: **PaddleSeg/output/horse/pseudo_color_prediction**


```python
# 查看预测结果文件夹分布
!tree PaddleSeg/output/horse -L 1
```

    PaddleSeg/output/horse
    ├── added_prediction
    └── pseudo_color_prediction
    
    2 directories, 0 files


分别展示两个文件夹中的预测结果(下载每个预测结果文件夹中的一两张图片到本地，然后上传notebook)

上传说明:

![](https://ai-studio-static-online.cdn.bcebos.com/29cb48e1263a4ea49557a8564f289be1690e1b23dab7412388420f9c244f366c)

> 以下为展示结果

<font color='red' size=5> ---数据集 horse 的预测结果展示--- </font>

<font color='black' size=5> 掩膜图像： </font>
![](https://ai-studio-static-online.cdn.bcebos.com/aa5d51e35f3d42fab42076e684bcdafef048ca81f2b74e03a7af5d60e9ff91a4)



<font color='black' size=5> 伪彩色图像： </font>
![](https://ai-studio-static-online.cdn.bcebos.com/1bf24fac4bf345d2ad1fe27fba6f93f64f10bea9cdd2404cb0e9933cae09fbf8)




<font color='red' size=5>特别声明，使用horse数据集进行提交时，预测结果展示不允许使用horse242.jpg和horse242.png的预测结果，否则将可能认定为未进行本baseline作业的训练、预测过程 </font>

# 六、提交作业流程

1. 生成项目版本

![](https://ai-studio-static-online.cdn.bcebos.com/1c19ac6cfb314353b5377421c74bc5d777dcb5724fad47c1a096df758198f625)

2. (有能力的同学可以多捣鼓一下)根据需要可将notebook转为markdown，自行提交到github上

![](https://ai-studio-static-online.cdn.bcebos.com/0363ab3eb0da4242844cc8b918d38588bb17af73c2e14ecd92831b89db8e1c46)

3. (一定要先生成项目版本哦)公开项目

![](https://ai-studio-static-online.cdn.bcebos.com/8a6a2352f11c4f3e967bdd061f881efc5106827c55c445eabb060b882bf6c827)

# 七、寄语

<font size=4>

最后祝愿大家都能完成本次作业，圆满结业，拿到属于自己独一无二的结业证书——这一次训练营，将是你们AI之路成长的开始！

希望未来的你们能够坚持在自己热爱的方向上继续自己的梦想！

同时也期待你们能够在社区中创造更多有创意有价值基于飞桨系列的AI项目，发扬开源精神！

<br>

最后，再次祝愿大家都能顺利结业！
 </font>
